version: "3.1"

intents:
  - saludo
  - explorar_temas
  - ingreso_zajuna
  - recuperar_contrasena
  - otro_problema_acceso
  - proceso_academico
  - ver_certificados
  - tutor_asignado
  - horarios_calendario
  - soporte_tecnico
  - problema_no_ingreso
  - pantalla_blanca
  - error_actividad
  - otro_problema_tecnico
  - escalar_humano
  - confirmacion_escalar_humano
  - negar_escalar
  - estado_estudiante
  - cambiar_idioma_ingles
  - cambiar_idioma_espanol
  - inscribirme
  - enviar_correo
  - auth_login          # analÃ­tica del botÃ³n "Iniciar sesiÃ³n"
  - affirm
  - deny
  - fallback
  - enviar_soporte      # â† aÃ±adido para manejar /enviar_soporte{...}

entities:
  - email

slots:
  email:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: email
      - type: from_text
  nombre:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
  mensaje:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text

forms:
  soporte_form:
    required_slots:
      - nombre
      - email
      - mensaje
  recovery_form:
    required_slots:
      - email

responses:
  utter_saludo:
    - text: "ğŸ¤– Â¡Hola! Â¿En quÃ© puedo ayudarte hoy?"
      buttons:
        - title: "ğŸ” Explorar temas"
          payload: "/explorar_temas"
        - title: "ğŸ“¥ Ingreso a Zajuna"
          payload: "/ingreso_zajuna"
        - title: "ğŸ“š Mis cursos y contenidos"
          payload: "/explorar_temas"
        - title: "ğŸ§¾ Proceso acadÃ©mico / administrativo"
          payload: "/proceso_academico"
        - title: "ğŸ› ï¸ Soporte tÃ©cnico"
          payload: "/soporte_tecnico"

  utter_cursos_carousel:
    - custom:
        cards:
          - title: "Excel BÃ¡sico"
            subtitle: "20h â€¢ Virtual"
            image: "https://via.placeholder.com/300x160?text=Excel"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"
          - title: "Soldadura MIG"
            subtitle: "40h â€¢ Presencial"
            image: "https://via.placeholder.com/300x160?text=Soldadura"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"
          - title: "ProgramaciÃ³n Web"
            subtitle: "60h â€¢ Virtual"
            image: "https://via.placeholder.com/300x160?text=Web"
            buttons:
              - title: "Inscribirme"
                payload: "/inscribirme"

  utter_cursos_recomendados:
    - text: "ğŸ“˜ AquÃ­ tienes algunos cursos que podrÃ­an interesarte:"
      buttons:
        - title: "ğŸŸ© Python BÃ¡sico â€“ Ago 2025"
          payload: "/inscribirme"
        - title: "ğŸŸ© IA Educativa â€“ Sep 2025"
          payload: "/inscribirme"

  utter_preguntar_problema_acceso:
    - text: "ğŸ¤– Entiendo. Â¿Tienes problemas de acceso? Â¿Deseas recuperar tu contraseÃ±a?"
      buttons:
        - title: "âœ… SÃ­, recuperar contraseÃ±a"
          payload: "/recuperar_contrasena"
        - title: "âŒ No, otro problema"
          payload: "/otro_problema_acceso"

  utter_pedir_correo:
    - text: "ğŸ“© Por favor, dime tu correo para enviarte el enlace de recuperaciÃ³n."

  utter_confirmar_recuperacion:
    - text: "âœ… Â¡Perfecto! Revisa tu bandeja de entrada."

  utter_menu_proceso_academico:
    - text: "Â¿Sobre quÃ© deseas informaciÃ³n?"
      buttons:
        - title: "ğŸ§‘â€ğŸ« Tutor asignado"
          payload: "/tutor_asignado"
        - title: "ğŸ“„ Certificados"
          payload: "/ver_certificados"
        - title: "ğŸ“… Horarios y calendario"
          payload: "/horarios_calendario"

  utter_certificados_info:
    - text: |
        ğŸ§¾ Python BÃ¡sico â€“ Nov 2024
        ğŸ§¾ IA Educativa â€“ Ene 2025
      buttons:
        - title: "ğŸ”— Descargar todos"
          payload: "/ver_certificados"
        - title: "ğŸŸ¢ Ver detalles"
          payload: "/ver_certificados"

  utter_tutor_asignado:
    - text: |
        ğŸ‘¨â€ğŸ« Tu tutor actual es:
        Nombre: Prof. Ana MarÃ­a Restrepo
        Email: ana.restrepo@zajuna.edu
        Horario: Lun y MiÃ© 10:00 â€“ 12:00
      buttons:
        - title: "ğŸ“… Ver disponibilidad"
          payload: "/tutor_asignado"
        - title: "âœ‰ï¸ Enviar mensaje"
          payload: "/tutor_asignado"

  utter_soporte_tecnico:
    - text: "ğŸ¤– Entiendo. Vamos a tomar tus datos para ayudarte mejor."

  utter_estado_estudiante:
    - text: "ğŸ“ EstÃ¡s **activo** para el periodo acadÃ©mico 2025-2."

  utter_cambio_idioma_ingles:
    - text: "Sure! Let's switch to English. You can ask me anything about your academic process or technical issues."

  utter_cambio_idioma_espanol:
    - text: "Volvamos a EspaÃ±ol ğŸ‡ªğŸ‡¸"

  utter_escalar_humano:
    - text: "ğŸ¤– Â¿Quieres que te comunique con un agente humano?"
      buttons:
        - title: "âœ… SÃ­, por favor"
          payload: "/confirmacion_escalar_humano"
        - title: "âŒ No, seguir con bot"
          payload: "/negar_escalar"

  utter_confirmar_escalado:
    - text: "ğŸ” Te estoy conectando con un agente humano, por favor espera..."

  utter_gracias_continuar:
    - text: "ğŸ‘ Perfecto, sigamos aquÃ­ en el chat."

  utter_confirmacion_inscripcion:
    - text: "âœ… EstÃ¡s inscrito al curso. Te enviaremos confirmaciÃ³n por correo."

  utter_default:
    - text: "âŒ No entendÃ­ eso. Â¿PodrÃ­as reformularlo?"

  # Prompts del soporte_form
  utter_ask_nombre:
    - text: "ğŸ‘¤ Â¿CuÃ¡l es tu nombre completo?"
  utter_ask_email:
    - text: "ğŸ“§ Â¿CuÃ¡l es tu correo de contacto?"
  utter_ask_mensaje:
    - text: "ğŸ“ CuÃ©ntame brevemente el problema tÃ©cnico (mÃ¡x. 5000 caracteres)."

  utter_soporte_form_ok:
    - text: "ğŸ™ Gracias. Estoy registrando tu solicitudâ€¦"

  utter_soporte_resumen:
    - text: |
        âœ… Gracias {nombre}. Voy a crear un ticket con:
        â€¢ Email: {email}
        â€¢ Mensaje: "{mensaje}"

  utter_soporte_creado:
    - text: "ğŸ« Ticket creado correctamente. Te enviaremos novedades a tu correo."

  utter_soporte_error:
    - text: "âš ï¸ OcurriÃ³ un error al crear el ticket. Intenta de nuevo en unos minutos."

  # ğŸ” Mensaje estÃ¡ndar cuando falta autenticaciÃ³n
  utter_need_auth:
    - text: "Necesitas iniciar sesiÃ³n para ver esta informaciÃ³n."
      buttons:
        - title: "Iniciar sesiÃ³n"
          payload: "/auth_login"
      custom:
        type: "auth_needed"
        message: "Necesitas iniciar sesiÃ³n para continuar."

actions:
  - action_enviar_correo
  - action_conectar_humano
  - action_soporte_submit
  - action_enviar_soporte       # â† ya contemplada
  - validate_soporte_form
  - validate_recovery_form
  - action_check_auth
  - action_health_check         # â† NUEVA acciÃ³n de health

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true