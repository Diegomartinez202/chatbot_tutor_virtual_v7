# ========================
# üåê ENTORNO (desarrollo)
# ========================
APP_ENV=dev
DEBUG=true
BASE_URL=http://localhost:8000

# CORS: or√≠genes del FE/embeds (CSV)
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:8080

# ========================
# üîê JWT
# ========================
SECRET_KEY=REEMPLAZA_CON_UNA_SECRETA_LARGA
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60

# ========================
# üì¶ MongoDB
# Preferido por /api/chat/audio y m√≥dulos nuevos
MONGODB_URL=mongodb://localhost:27017
MONGODB_DB=chatbot_tutor_virtual_v2
# Compat (si alguna parte del c√≥digo lee MONGO_*)
MONGO_URI=${MONGODB_URL}
MONGO_DB_NAME=${MONGODB_DB}

# ========================
# ü§ñ Rasa
# BASE (sin /webhooks/rest/webhook)
RASA_URL=http://localhost:5005
# Router de audio usa REST directo:
RASA_REST_URL=http://localhost:5005/webhooks/rest/webhook
# (Opcional) WS si tu FE lo usa:
RASA_WS_URL=ws://localhost:5005/ws

# ========================
# üßæ Logs/Static
# ========================
LOG_DIR=logs
STATIC_DIR=backend/static
TEMPLATE_DIR=backend/templates
FAVICON_PATH=backend/static/favicon.ico

# ========================
# üìÑ EMBED / CSP
# Si EMBED_ALLOWED_ORIGINS est√° presente, el middleware la usa para frame-ancestors
FRAME_ANCESTORS='self'
EMBED_ALLOWED_ORIGINS='self' http://localhost:5173 http://localhost:8080
FRONTEND_SITE_URL=http://localhost:8080
EMBED_ENABLED=true

# ========================
# üö¶ Rate limiting
# ========================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_BACKEND=memory
RATE_LIMIT_WINDOW_SEC=60
RATE_LIMIT_MAX_REQUESTS=60
REDIS_URL=

# ========================
# üéôÔ∏è AUDIO (para /api/chat/audio)
# ========================
AUDIO_TTL_DAYS=7

# ========================
# ‚òÅÔ∏è AWS S3 (opcional)
# ========================
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET_NAME=chatbot-tutor-exports
AWS_S3_REGION=us-east-1
AWS_S3_ENDPOINT_URL=https://s3.amazonaws.com

# ========================
# üÜò Helpdesk / Escalada a humano (opcional)
# ========================
HELPDESK_KIND=webhook
HELPDESK_WEBHOOK=http://localhost:8000/api/helpdesk/tickets
HELPDESK_TOKEN=


# ========================
# üåê ENTORNO
# ========================
APP_ENV=dev
DEBUG=true
BASE_URL=http://localhost:8000

# ========================
# üîê JWT
# ========================
SECRET_KEY=pon_una_llave_larga_y_segura
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
# Refresh (si aplica en tu backend/panel)
REFRESH_TOKEN_EXPIRE_DAYS=7
REFRESH_COOKIE_NAME=rt

# ========================
# üì¶ MongoDB
# ========================
MONGO_URI=mongodb://localhost:27017
MONGO_DB_NAME=chatbot_tutor_virtual_v2

# Compat (algunos m√≥dulos antiguos)
MONGODB_URL=mongodb://localhost:27017
MONGODB_DB=chatbot_tutor_virtual_v2
MONGO_URL=mongodb://localhost:27017
MONGO_DB=chatbot_admin

# ========================
# ü§ñ Rasa
# ========================
RASA_URL=http://localhost:5005
RASA_REST_URL=http://localhost:5005/webhooks/rest/webhook

RASA_DATA_PATH=rasa/data/nlu.yml
RASA_DOMAIN_PATH=rasa/domain.yml
RASA_MODEL_PATH=rasa/models
RASA_TRAIN_COMMAND=rasa train

# ========================
# üßæ Logs / est√°ticos
# ========================
LOG_DIR=logs
STATIC_DIR=backend/static
TEMPLATE_DIR=backend/templates
FAVICON_PATH=backend/static/favicon.ico

# ========================
# üåê CORS / EMBED / CSP
# ========================
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:8080,https://tu-frontend.com
FRAME_ANCESTORS='self'
EMBED_ALLOWED_ORIGINS='self', http://localhost:5173, http://localhost:8080
FRONTEND_SITE_URL=http://localhost:5173
EMBED_ENABLED=true

# ========================
# üö¶ Rate limiting
# ========================
# Activa/desactiva el rate limit (decoradores @limit + middleware SlowAPI)
RATE_LIMIT_ENABLED=true

# Estrategia de clave:
#  - user_or_ip ‚Üí usa JWT.sub si hay sesi√≥n; si no, IP
#  - skip_admin ‚Üí igual que user_or_ip pero exime a rol=admin
#  - ip ‚Üí solo IP
RATE_LIMIT_KEY_STRATEGY=user_or_ip

# Storage:
# 1) Recomendado en prod ‚Üí Redis
# RATE_LIMIT_STORAGE_URI=redis://localhost:6379/0
# 2) Dev/local ‚Üí memoria (por defecto)
# RATE_LIMIT_STORAGE_URI=memory://

# Compatibilidad con tu configuraci√≥n anterior:
RATE_LIMIT_BACKEND=memory   # o "redis"
REDIS_URL=                  # p. ej. redis://localhost:6379/0 (si usas redis)

# Ventana y tope globales (si los usas en tu middleware legacy)
RATE_LIMIT_WINDOW_SEC=60
RATE_LIMIT_MAX_REQUESTS=60

# ========================
# ‚òÅÔ∏è AWS S3 (opcional: exports)
# ========================
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET_NAME=chatbot-tutor-exports
AWS_S3_REGION=us-east-1
AWS_S3_ENDPOINT_URL=https://s3.amazonaws.com

# ========================
# üÜò Helpdesk (opcional)
# ========================
HELPDESK_KIND=webhook
HELPDESK_WEBHOOK=http://localhost:8000/api/helpdesk/tickets
HELPDESK_TOKEN=

# ========================
# üìß SMTP
# ========================
SMTP_SERVER=localhost
SMTP_PORT=587
SMTP_USER=demo@example.com
SMTP_PASS=demo
EMAIL_FROM=demo@example.com
EMAIL_TO=admin@example.com
ADMIN_EMAIL=admin@example.com

# ========================
# üîê Registro/lockout admin (panel)
# ========================
ADMIN_REGISTRATION_OPEN=true
FIRST_ADMIN_IS_ADMIN=true
LOGIN_MAX_ATTEMPTS=5
LOGIN_BLOCK_MINUTES=15
MIN_PASSWORD_LEN=8
PW_REQUIRE_UPPER=true
PW_REQUIRE_LOWER=true
PW_REQUIRE_DIGIT=true
PW_REQUIRE_SYMBOL=true